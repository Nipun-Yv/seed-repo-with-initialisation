# Certificate Setup for Adobe CLI Backend (Local Development)

This guide explains how to generate SSL certificates using `mkcert` for running the Adobe CLI backend locally.

## Prerequisites

- `mkcert` is already installed on your system
- You have administrator privileges (required for installing the local CA)

## Step 1: Install the Local CA (One-time setup)

First, you need to install mkcert's local Certificate Authority (CA) on your system. This allows browsers and the Adobe CLI to trust certificates generated by mkcert.

Open PowerShell as Administrator and run:

```powershell
mkcert -install
```

This will install the local CA root certificate in your system's trust store.

## Step 2: Generate Certificates

Navigate to your project directory and create a `certs` folder (if it doesn't exist):

```powershell
mkdir certs
cd certs
```

Generate certificates for localhost. Adobe CLI typically uses `localhost` and `127.0.0.1`:

```powershell
mkcert localhost 127.0.0.1 ::1
```

This will create two files:
- `localhost+2.pem` (certificate)
- `localhost+2-key.pem` (private key)

**Note:** The `+2` in the filename indicates it covers 2 domains (localhost and 127.0.0.1). If you need additional domains, you can specify them.

### Alternative: Custom Domain Names

If you need to use a specific domain (e.g., `myaddon.local`), you can:

1. Add the domain to your hosts file:
   ```
   C:\Windows\System32\drivers\etc\hosts
   ```
   Add: `127.0.0.1    myaddon.local`

2. Generate certificate with custom domain:
   ```powershell
   mkcert myaddon.local localhost 127.0.0.1
   ```

## Step 3: Configure Your Development Server

The Adobe CLI backend typically uses the `@adobe/ccweb-add-on-scripts` package which may have built-in SSL support. However, if you need to configure it manually:

### Option A: Using Environment Variables

Set environment variables pointing to your certificates:

```powershell
$env:SSL_CERT_FILE="certs\localhost+2.pem"
$env:SSL_KEY_FILE="certs\localhost+2-key.pem"
npm start
```

### Option B: Configure in webpack.config.js

If you need to configure webpack dev server with HTTPS, add this to your `webpack.config.js`:

```javascript
const fs = require('fs');
const path = require('path');

// ... existing code ...

module.exports = {
    // ... existing config ...
    devServer: {
        https: {
            key: fs.readFileSync(path.resolve(__dirname, 'certs/localhost+2-key.pem')),
            cert: fs.readFileSync(path.resolve(__dirname, 'certs/localhost+2.pem')),
        },
        port: 3000,
        host: 'localhost'
    }
};
```

## Step 4: Verify Certificates

1. Start your development server
2. Open your browser and navigate to `https://localhost:3000` (or your configured port)
3. You should see a valid SSL certificate without browser warnings

## Troubleshooting

### Certificate not trusted
- Make sure you ran `mkcert -install` as Administrator
- Restart your browser after installing the CA
- On Windows, you may need to restart your computer

### Port already in use
- Change the port in your dev server configuration
- Or stop the process using the port: `netstat -ano | findstr :3000` then `taskkill /PID <pid> /F`

### Adobe CLI not recognizing certificates
- Ensure the certificate files are in the correct location
- Check that the domain names in the certificate match what you're accessing
- Verify the certificate hasn't expired (mkcert certificates are valid for a long time)

## Additional Notes

- Keep the `certs` folder in your `.gitignore` (certificates should not be committed)
- The certificates generated by mkcert are valid for local development only
- If you regenerate certificates, you may need to clear browser cache
